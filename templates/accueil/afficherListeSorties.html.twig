{% extends 'base.html.twig' %}



{% block body %}

     {% for message in app.flashes('info') %}


        <div class="alert alert-success">
            {{ message }}
        </div>

    {% endfor %}
    <h1>Filtrer les sorties</h1>

    <br><br>
    <table id="sortieTable" class="table table-striped table-bordered" style="width:100%">
        <thead class="thead-dark text-center">
        <tr>
            <th scope="col">Nom de la sortie</th>
            <th scope="col">Date de la sortie</th>
            <th scope="col">Cl√¥ture</th>
            <th scope="col">Inscrits/Places</th>
            <th scope="col">Etat</th>
            <th scope="col">Inscrit</th>
            <th scope="col">Organisateur</th>
            <th scope="col">Actions</th>

        </tr>
        </thead>
        <tbody>

        {% for sortie in sorties %}
        {% set participantInscrit = false %}
        {% set etat='ouvert' %}
        {% if sortie.dateHeureDebut|date("Y/m/d H:i") == now|date("Y/m/d H:i") %}
             {% set etat='en cours' %}
        {% elseif sortie.dateHeureDebut|date("Y/m/d H:i") < now|date("Y/m/d H:i") and (sortie.dateHeureDebut |date_modify("+"~sortie.duree~" minutes") | date("Y/m/d H:i") > now|date("Y/m/d H:i")) %}
            {% set etat='en cours' %}
       {% elseif sortie.dateLimiteInscription|date("Y/m/d") == now|date("Y/m/d") %}
            {% set etat='ferm√©' %}
        {% elseif sortie.dateLimiteInscription|date("Y/m/d") < now|date("Y/m/d") %}
            {% set etat='ferm√©' %}
        {% elseif sortie.dateLimiteInscription|date("Y/m/d") > now|date("Y/m/d") %}
            {% set etat='ouvert' %}
        {% endif %}
        {% set dateDebut = sortie.dateHeuredebut|date('Y-m-d') %}
        {% set dateDifference = "now"|date('Y-m-d') %}
        {% set archive = date(dateDifference).diff(date(dateDebut))%}

        {% if archive.days >= 30 %}
        {% else %}
     {% if app.user.userIdentifier is null %}
         {% else %}
        {% for inscription in app.user.inscriptions %}
            {% for inscriptions in sortie.inscriptions %}
                {% if inscription == inscriptions %}
                    {% set participantInscrit = true %}
                {% endif %}
            {% endfor %}
        {% endfor %}

        {% endif %}
        <tr class="text-center">
            <td scope="row">{{ sortie.nom }}</td>
            <td scope="row">le {{ sortie.dateHeureDebut|date("d/m/Y") }} √† {{ sortie.dateHeureDebut|date("H:i") }}</td>
            <td scope="row">{{ sortie.dateLimiteInscription|date("d/m/Y") }}</td>
            <td scope="row">{{ sortie.inscriptions|length }}/{{ sortie.nbInscriptionsMax }}</td>
                <td scope="row">{{ etat }}</td>
                <td scope="row">
                    {% if participantInscrit ==true %}
                        <p>üêº</p>
                    {% else %}
                        <p></p>
                    {% endif %}
                </td>
            <td scope="row"><a href="">{{ sortie.organisateur.username }}</a></td>
                <td scope="row">
                   {% if  sortie.inscriptions|length== sortie.nbInscriptionsMax and etat == 'ouvert' %}
                       {%  if participantInscrit %}
                    <a href=""  class="btn btn-primary btn-sm bouton">
                        Afficher
                    </a>
                        <a href="{{ path('retrait_participant_sortie', {'id': sortie.id}) }}"  class="btn btn-primary btn-sm bouton">
                            Se d√©sister
                        </a>
                       {% else %}
                           <a href=""  class="btn btn-primary btn-sm bouton">
                               Afficher
                           </a>
                        {% endif %}

                   {% elseif sortie.inscriptions|length<sortie.nbInscriptionsMax and etat == 'ouvert' and sortie.organisateur.username==app.user.userIdentifier %}
                       <a href=""  class="btn btn-primary btn-sm bouton">
                           Afficher
                       </a><a>             </a>
                       <a href=""  class="btn btn-primary btn-sm bouton">
                           Annuler
                       </a>

                    {% elseif sortie.inscriptions|length<sortie.nbInscriptionsMax and etat == 'ouvert' %}
                         {%  if participantInscrit %}
                    <a href=""  class="btn btn-primary btn-sm bouton">
                        Afficher
                    </a><a>             </a>
                    <a href="{{ path('retrait_participant_sortie', {'id': sortie.id}) }}"  class="btn btn-primary btn-sm bouton">
                        Se d√©sister
                    </a>
                        {% else %}
                        <a href=""  class="btn btn-primary btn-sm bouton">
                            Afficher
                        </a><a>             </a>
                        <a href="{{ path('ajout_participant_sortie', {'id': sortie.id}) }}"  class="btn btn-primary btn-sm bouton">
                        S'inscrire
                    </a>
                         {% endif %}



                    {% elseif etat == 'ferm√©'%}
                    <a href=""  class="btn btn-primary btn-sm bouton">
                        Afficher
                    </a><a>             </a>
                    {% elseif etat == 'en cours'%}
                        <a href=""  class="btn btn-primary btn-sm bouton">
                            Afficher
                        </a><a>             </a>
                    {% elseif etat == 'en cr√©ation'%}
                        <a href=""  class="btn btn-primary btn-sm bouton">
                            Modifier
                        </a><a>             </a>
                        <a href=""  class="btn btn-primary btn-sm bouton">
                            Publier
                        </a>
                    {% elseif etat == 'annul√©'%}
                        <a href=""  class="btn btn-primary btn-sm bouton">
                            Afficher
                        </a><a>             </a>
                   {% endif %}
                </td>

               <br>
            {% endif %}
            {% else %}
                <p>Aucune sortie trouv√©e</p>

            {% endfor %}
        </tr>
        </tbody>

    </table>

<br> <br>

{% endblock %}

{% block title %}

{% endblock %}
